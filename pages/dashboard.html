<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‚Äì HomeBudget</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg: #FDF9F0;
      --divider: #E7DFD8;
      --navy: #0A1F44;
      --accent: #F7B538;
      --muted: #5A6776;
    }
    body {
      background: var(--bg);
    }
  </style>

  <script>
    const userId = localStorage.getItem('userId');
    const role = localStorage.getItem('role');
    const monthNames = ['Jan', 'Fab', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec']

    const currDate = new Date();

    const month = monthNames[currDate.getMonth()];

    const year = currDate.getFullYear();

    let symbol = "";
    let income = 0;
    let expense = 0;

    if (!userId) {
      window.location.href = "http://127.0.0.1:5500/pages/login.html"
    }else if(role === 'ADMIN'){
      window.location.href = "http://127.0.0.1:5500/pages/admin/index.html"
    }
     else {
      fetch(`http://192.168.1.142:3000/api/user?userId=${userId}`).then(async (response) => {
        let res_data = await response.json();
        let income = res_data.income;
        let userData = res_data.user;
        let currency = userData.currency;
        if (currency == "INR") {
          symbol = "‚Çπ";
        } else if (currency == "USD") {
          symbol = "$";
        } else if (currency == "EUR") {
          symbol = "‚Ç¨";
        } else if (currency == "") {
          symbol = "¬£";
        }

        document.getElementById('amt-in').placeholder = `Amount (${symbol})`;
        document.getElementById('monthly-goal').innerText = `${symbol}${userData.goal}`

        document.getElementById('lastname').innerText = userData.family_name + "'s Family";
      }).then(()=>{

        fetch(`http://192.168.1.142:3000/api/transcation/get-income-expense?userId=${userId}&month=${month}&year=${year}`).then(async (response) => {
          let res_data = await response.json() ?? {income : 0 ,expense :0};
  
          income = res_data.income;
          expense = res_data.expense;
          
  
          document.getElementById("income").innerText = `${symbol}${income}`;
          document.getElementById("expense").innerText = `${symbol}${expense}`;
        })
      })
    }
  </script>
</head>
<body class="font-sans text-[--muted]">

  <!-- HEADER -->
  <header class="fixed top-0 w-full z-50 bg-[--navy] text-white shadow-md">
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="font-bold text-xl">Dashboard</h1>
      <nav class="space-x-6 text-sm">
        <a href="../index.html" class="hover:text-[--accent]">‚Üê Back Home</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="pt-24 pb-12 px-4 max-w-6xl mx-auto space-y-10">

    <!-- Greeting -->
    <section class="bg-white rounded-xl shadow border border-[--divider] p-6">
      <h2 class="text-xl font-bold text-[--navy]">Welcome back, <span id="lastname"></span> üëã</h2>
      <p class="mt-1">Here‚Äôs a quick look at your monthly budget progress.</p>
    </section>

    <!-- Budget Overview -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-white rounded-xl shadow border border-[--divider] p-6">
        <h3 class="font-semibold text-[--navy] mb-2">Monthly Goal</h3>
        <p class="text-2xl font-bold text-[--accent]" id="monthly-goal"></p>
        <div class="mt-3 w-full bg-[--divider] rounded-full h-3">
          <div class="bg-[--accent] h-3 rounded-full w-[60%]"></div>
        </div>
        <p class="mt-1 text-sm">60% used</p>
      </div>
      <div class="bg-white rounded-xl shadow border border-[--divider] p-6">
        <h3 class="font-semibold text-[--navy] mb-2">Total Income</h3>
        <p class="text-xl font-bold text-green-600" id="income"></p>
      </div>
      <div class="bg-white rounded-xl shadow border border-[--divider] p-6">
        <h3 class="font-semibold text-[--navy] mb-2">Total Expenses</h3>
        <p class="text-xl font-bold text-red-500" id="expense"></p>
      </div>
    </section>

    <!-- Quick Add -->
    <section class="bg-white rounded-xl shadow border border-[--divider] p-6">
      <h3 class="font-semibold text-[--navy] mb-4">Quick Add</h3>
      <form class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
        <input id="desc-in" type="text" placeholder="Description"
          class="col-span-2 px-3 py-2 border border-[--divider] rounded-lg focus:ring-[--accent]" />
        <input id="amt-in" type="number" min="1"
          class="px-3 py-2 border border-[--divider] rounded-lg focus:ring-[--accent]" />
        <select id="transition-type"
          class="px-3 py-2 border border-[--divider] rounded-lg bg-white focus:ring-[--accent]">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
      </form>
      <button id="add-entry-btn"
        class="mt-4 bg-[--accent] text-[--navy] font-semibold py-2 px-6 rounded-lg hover:bg-yellow-400">
        Add Entry
      </button>
    </section>

    <!-- Transactions -->
    <section class="bg-white rounded-xl shadow border border-[--divider] p-6">
      <h3 class="font-semibold text-[--navy] mb-4">Recent Transactions</h3>
      <table class="w-full text-sm">
        <thead class="text-left text-[--navy] border-b border-[--divider]">
          <tr>
            <th class="py-2">Date</th>
            <th>Description</th>
            <th>Type</th>
            <th class="text-right">Amount</th>
            <th class="text-right">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

    <!-- Family Members -->
    <section class="bg-white rounded-xl shadow border border-[--divider] p-6">
      <h3 class="font-semibold text-[--navy] mb-4">Family Members</h3>
      <ul class="space-y-2 text-sm">
        <li class="flex justify-between"><span>Dhruvi</span><span class="text-[--muted]">Admin</span></li>
        <li class="flex justify-between"><span>Harsh</span><span class="text-[--muted]">Viewer</span></li>
      </ul>
    </section>

  </main>


<div id="update-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg w-full max-w-md">
    <h3 class="text-lg font-semibold mb-4">Update Transaction</h3>
    <input id="update-date" type="date" class="w-full mb-2 px-3 py-2 border rounded" />
    <input id="update-desc" type="text" placeholder="Description" class="w-full mb-2 px-3 py-2 border rounded" />
    <input id="update-amt" type="number" min="1" class="w-full mb-2 px-3 py-2 border rounded" />
    <select id="update-type" class="w-full mb-4 px-3 py-2 border rounded">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <div class="flex justify-end space-x-2">
      <button id="cancel-update" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button id="save-update" class="px-4 py-2 bg-[--accent] text-white rounded">Save</button>
    </div>
  </div>
</div>


  <script src="../js/dashboard.js"></script>
</body>
</html>
